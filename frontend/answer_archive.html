<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DoubtOut – Answer Archive</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f8ff;
    }

    .hand-drawn-card {
      border: 4px solid #1f2937;
      box-shadow: 8px 8px 0px rgba(31, 41, 55, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .hand-drawn-card:hover {
      transform: translate(-2px, -2px);
      box-shadow: 10px 10px 0px rgba(31, 41, 55, 0.5);
    }

    .archive-item {
      border-bottom: 1px dashed rgba(84,168,227,0.3);
      padding: 16px 0;
    }
  </style>
</head>

<body>

<!-- HEADER -->
<header class="bg-gray-900 text-white shadow-xl">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-width="2" d="M12 6.253v13" />
      </svg>
      <span class="text-xl font-bold text-blue-400">doubtout</span>
    </div>

    <nav class="hidden md:flex space-x-4">
      <a href="home.html" class="px-3 py-2 rounded-lg hover:bg-gray-700">Home</a>
      <a href="answer_archive.html" class="px-3 py-2 rounded-lg bg-blue-600">Archive</a>
      <a href="student_login.html" class="px-3 py-2 rounded-lg hover:bg-gray-700">Ask a Doubt</a>
      <a href="login1.html" class="px-3 py-2 rounded-lg bg-green-500 text-gray-900">Login</a>
    </nav>
  </div>

  <!-- SEARCH BAR -->
  <div class="pb-6 flex justify-center">
    <input
      id="searchInput"
      type="search"
      placeholder="Search questions, subjects, keywords..."
      class="w-full max-w-2xl px-5 py-2 rounded-full border-2 border-gray-600
             text-gray-900 focus:ring-4 focus:ring-orange-500/50"
    />
  </div>
</header>

<!-- MAIN -->
<main class="max-w-7xl mx-auto px-6 py-10">

  <!-- FILTER CARD -->
  <div class="hand-drawn-card bg-white rounded-xl p-6 mb-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
      Filter Answer Archive
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <select id="semesterFilter" class="px-4 py-2 border-2 rounded-lg">
        <option value="">All Semesters</option>
        <option value="1">Semester 1</option>
        <option value="1">Semester 2</option>
        <option value="3">Semester 3</option>
        <option value="4">Semester 4</option>
                <option value="5">Semester 5</option>
        <option value="6">Semester 6</option>
        <option value="7">Semester 7</option>
        <option value="8">Semester 8</option>

      </select>
<select id="subjectFilter" class="px-4 py-2 border-2 rounded-lg">
  <option value="">All Subjects</option>
</select>

      
      <button onclick="applyFilters()"
        class="cta-button bg-blue-500 hover:bg-orange-600 text-gray-900 font-bold rounded-lg">
        Apply Filters
      </button>
    </div>
  </div>

  <!-- ARCHIVE LIST -->
  <div class="hand-drawn-card bg-gray-800 text-white rounded-xl p-6">
    <h2 class="text-3xl font-bold text-blue-300 mb-6 text-center">
      Verified Question Archive
    </h2>

    <div id="archiveList">
      <!-- ITEMS INSERTED HERE -->
    </div>

    <p id="emptyMsg" class="hidden text-center text-gray-300 py-10">
      No questions match your filters.
    </p>
  </div>

</main>

<!-- SCRIPT -->
<script>
const API_URL = "http://localhost:3000/api";

async function loadArchive() {
    const semester = document.getElementById("semesterFilter").value;
    const subject = document.getElementById("subjectFilter").value;
    const search = document.getElementById("searchInput").value;

    const params = new URLSearchParams();
    if (semester) params.append("semester", semester);
    if (subject) params.append("course", subject);
    if (search) params.append("search", search);

    try {
        const res = await fetch(`${API_URL}/archive?${params.toString()}`);
        const data = await res.json();
        renderArchive(data.archive);
    } catch (err) {
        console.error("Failed to load archive", err);
    }
}
async function loadArchiveSubjects() {
    const semester = document.getElementById("semesterFilter").value;
    const subjectSelect = document.getElementById("subjectFilter");

    subjectSelect.innerHTML = `<option value="">Loading...</option>`;

    if (!semester) {
        subjectSelect.innerHTML = `<option value="">All Subjects</option>`;
        return;
    }

    const departmentId = 1; 

    const res = await fetch(
        `${API_URL}/subjects?department_id=${departmentId}&semester=${semester}`
    );
    const data = await res.json();

    subjectSelect.innerHTML = `<option value="">All Subjects</option>`;
    data.subjects.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.subject_name;
        opt.textContent = s.subject_name;
        subjectSelect.appendChild(opt);
    });
}

document.getElementById("semesterFilter").addEventListener("change", () => {
    loadArchiveSubjects();
    loadArchive();
});

function renderArchive(items) {
    const list = document.getElementById("archiveList");
    const empty = document.getElementById("emptyMsg");
    list.innerHTML = "";

    if (!items || items.length === 0) {
        empty.classList.remove("hidden");
        return;
    }

    empty.classList.add("hidden");

    items.forEach(q => {
        list.innerHTML += `
            <div class="archive-item">
                <h3 class="text-xl font-bold text-blue-300">${q.question}</h3>
                <p class="text-sm text-gray-400">
                    ${q.course} | Semester ${q.semester}
                </p>

                <p class="mt-2 text-gray-200">
                    ${q.answer_text}
                </p>

                <p class="mt-1 text-sm text-green-400">
                    ✔ Answered by ${q.answered_by}
                </p>
            </div>
        `;
    });
}

// Live search + filters
document.getElementById("searchInput").addEventListener("input", loadArchive);
document.getElementById("semesterFilter").addEventListener("change", loadArchive);
document.getElementById("subjectFilter").addEventListener("change", loadArchive);

document.addEventListener("DOMContentLoaded", loadArchive);
</script>


</body>
</html>
