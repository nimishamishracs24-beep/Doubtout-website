<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doubtout - My Questions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f8ff;
        }
        .question-list-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .question-list-scroll::-webkit-scrollbar-thumb {
            background: #93c5fd;
            border-radius: 3px;
        }
    </style>
</head>
<body>

<header class="bg-gray-900 text-white shadow-xl">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center space-x-2">
        <span class="text-xl font-bold text-blue-400">DoubtOut</span>
    </div>
</header>

<nav class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-center space-x-8">
        <a href="student_dashboard.html">My Dashboard</a>
        <a href="student_questions.html" class="text-blue-600 font-bold border-b-2 border-blue-600">My Questions</a>
        <a href="student_contributions.html">My Contributions</a>
        <a href="doubts.html">Ask a Doubt</a>
        <a href="practice_session.html">Practice Sessions</a>
    </div>
</nav>

<main class="max-w-7xl mx-auto px-4 py-10">
    <h1 class="text-4xl font-extrabold text-center mb-8">My Submitted Doubts</h1>

    <div class="bg-white p-6 rounded-xl shadow-lg">
        <div class="flex border-b mb-6">
            <button data-status="active"
                class="tab-btn border-b-2 border-blue-600 text-blue-600 px-6 py-3 font-medium">
                Active Questions (<span id="count-active">0</span>)
            </button>
            <button data-status="answered"
                class="tab-btn border-b-2 border-transparent text-gray-500 px-6 py-3 font-medium">
                Answered Questions (<span id="count-answered">0</span>)
            </button>
        </div>

        <div id="question-list-container" class="space-y-4 max-h-[60vh] overflow-y-auto"></div>

        <div id="empty-state" class="hidden text-center py-12 text-gray-500">
            You have no questions in this category.
        </div>
    </div>
</main>

<script>
const API_URL = "https://doubtout-website.onrender.com/api";
const user = JSON.parse(localStorage.getItem("doubtoutUser"));
const userId = user?.user_id;

let currentStatusFilter = "active";
let allQuestions = [];

document.addEventListener("DOMContentLoaded", () => {
    if (!userId) {
        alert("Please login first");
        window.location.href = "login.html";
        return;
    }

    loadQuestions();

    document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".tab-btn").forEach(b => {
                b.classList.remove("border-blue-600", "text-blue-600");
                b.classList.add("border-transparent", "text-gray-500");
            });

            btn.classList.add("border-blue-600", "text-blue-600");
            btn.classList.remove("border-transparent", "text-gray-500");

            currentStatusFilter = btn.dataset.status;
            renderQuestions();
        });
    });
});

async function loadQuestions() {
    try {
        const res = await fetch(`${API_URL}/student/questions/${userId}`);
        const data = await res.json();
        allQuestions = data.questions || [];
        updateCounts();
        renderQuestions();
    } catch (err) {
        console.error("Failed to load questions", err);
    }
}

function updateCounts() {
    document.getElementById("count-active").textContent =
        allQuestions.filter(q => !q.answer_text).length;

    document.getElementById("count-answered").textContent =
        allQuestions.filter(q => q.answer_text).length;
}

function renderQuestions() {
    const container = document.getElementById("question-list-container");
    const emptyState = document.getElementById("empty-state");
    container.innerHTML = "";

    const filtered = allQuestions.filter(q => {
        const answered = q.answer_text && q.answer_text.trim() !== "";
        return currentStatusFilter === "answered" ? answered : !answered;
    });

    if (filtered.length === 0) {
        emptyState.classList.remove("hidden");
        return;
    }

    emptyState.classList.add("hidden");

    filtered.forEach(q => {
        const isAnswered = q.answer_text && q.answer_text.trim() !== "";
        const card = document.createElement("div");
        card.className = "p-4 border rounded-lg shadow";

        card.innerHTML = `
            <h3 class="text-xl font-bold">${q.question}</h3>
            


            <div class="mt-3">
                <span class="px-3 py-1 rounded-full text-sm ${
                    isAnswered ? "bg-green-100 text-green-700" : "bg-yellow-100 text-yellow-700"
                }">
                    ${isAnswered ? "Answered" : "Pending"}
                </span>
            </div>

            ${
                isAnswered
                ? `<div class="mt-4 bg-blue-50 p-4 rounded">
                        <p class="text-sm"><strong>Answered by:</strong> ${q.answered_by_name}</p>
                        <p class="mt-2">${q.answer_text}</p>
                   </div>`
                : ""
            }
        `;
        container.appendChild(card);
    });
}
</script>

</body>
</html>
