<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doubtout - Professor Review Dashboard</title>
    <!-- Load Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import and general base styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f8ff; /* Light blue background */
        }
        
        /* Custom scrollbar for review list */
        .review-list-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .review-list-scroll::-webkit-scrollbar-thumb {
            background: #93c5fd; /* Blue-300 */
            border-radius: 3px;
        }
        
        /* Custom ring color for focus states (Updated to Green) */
        .focus-ring-green {
            outline: none;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.5); /* Emerald-500 with transparency */
        }
    </style>
</head>
<body>

    <!-- Main Header (Dark theme - Adjusted for Professor Persona - GREEN) -->
    <header class="bg-green-700 text-white shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                
                <!-- Logo Block (Green Accent) -->
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.057l-1.976-.662M12 14l-6.16 3.422a12.083 12.083 0 01-.665-6.479A11.952 11.952 0 0012 20.057l1.976-.662" />
                    </svg>
                    <span class="text-xl font-bold tracking-tight text-green-300">DoubtOut - Professor</span>
                </div>

                <!-- Professor Navigation Links -->
                
            </div>
        </div>
    </header>
    
    <!-- Sub-Navigation / Professor Dashboard Links -->
    <nav class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-center flex-wrap space-x-4 sm:space-x-8 text-sm sm:text-base">
            <a href="professor_dashboard.html" class="text-gray-700 hover:text-green-600 font-semibold transition duration-150">Dashboard</a>
            <a href="my_solutions.html" class="text-gray-700 hover:text-green-600 font-semibold transition duration-150">My solutions</a>
            <a href="pending_review.html" class="text-green-600 border-b-2 border-green-600 font-bold transition duration-150">Pending Answer Review</a>
            <a href="clear_doubts.html" class="text-gray-700 hover:text-green-600 font-semibold transition duration-150">Clear Doubts</a>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <h1 class="text-4xl font-extrabold text-gray-800 text-center mb-4">
            Pending Student Answer Review
        </h1>
        <p class="text-center text-gray-600 mb-8">
            Verify and approve student-provided answers to maintain knowledge base quality.
        </p>

        <!-- Metrics & Filter Controls -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Total Pending (GREEN) -->
                <div class="bg-green-50 p-4 rounded-xl border border-green-200 text-center">
                    <p class="text-sm font-medium text-gray-500">Total Pending Answers</p>
                    <p id="total-pending" class="text-3xl font-bold text-green-700 mt-1">0</p>
                </div>
                
                <!-- Average Wait Time (YELLOW/AMBER for contrast) -->
               
                
                <!-- Course Filter -->
               
            </div>
        </div>

        <!-- Review List Container -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Answers Awaiting Verification</h2>
            
            <div id="review-list" class="space-y-4 max-h-[60vh] overflow-y-auto review-list-scroll">
                <!-- Pending review items will be dynamically injected here -->
            </div>
            
            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-16 text-gray-500">
                <svg class="mx-auto h-12 w-12 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-9.618 3.047A10.005 10.005 0 0012 21a10.005 10.005 0 009.618-14.016z" />
                </svg>
                <p class="mt-2 text-xl font-medium">All clear!</p>
                <p class="text-sm">There are no student answers currently pending your review.</p>
            </div>
        </div>

    </main>

    
    <!-- JavaScript for Data Management and Rendering -->
    <script>
const API = "https://doubtout-website.onrender.com/api";
const professor = JSON.parse(localStorage.getItem("doubtoutUser"));

let pendingAnswers = [];

document.addEventListener("DOMContentLoaded", () => {
    if (!professor || professor.role !== "professor") {
        alert("Unauthorized");
        window.location.href = "login.html";
        return;
    }

    loadPendingReviews();
});
function renderAnswers(items) {
    const list = document.getElementById("review-list");
    const emptyState = document.getElementById("empty-state");

    list.innerHTML = "";

    if (!items || items.length === 0) {
        list.classList.add("hidden");
        emptyState.classList.remove("hidden");
        return;
    }

    list.classList.remove("hidden");
    emptyState.classList.add("hidden");

    items.forEach(item => {
        const card = document.createElement("div");
        card.className =
            "bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500";

        card.innerHTML = `
            <h3 class="text-lg font-semibold text-gray-800">
                ${item.question}
            </h3>

            <p class="text-sm text-gray-500">
                <strong>Course:</strong> ${item.course}
            </p>

            <p class="text-sm text-gray-600 mt-2">
                <strong>Student:</strong> ${item.student_name}
            </p>

            <p class="mt-3 text-gray-800 bg-gray-50 p-3 rounded-lg border">
                ${item.answer_text}
            </p>

            <div class="flex gap-3 mt-4">
               <button onclick="reviewAnswer(${item.practice_id}, 'approved')"
    class="px-4 py-2 bg-green-600 text-white rounded-lg">
    Approve
</button>

<button onclick="reviewAnswer(${item.practice_id}, 'rejected')"
    class="px-4 py-2 bg-red-600 text-white rounded-lg">
    Reject
</button>

            </div>
        `;

        list.appendChild(card);
    });
}

async function loadPendingReviews() {
    try {
        const res = await fetch(`${API}/professor/practice/${professor.user_id}`);
        const data = await res.json();

        pendingAnswers = data.practices;

        document.getElementById("total-pending").textContent = pendingAnswers.length;
        renderAnswers(pendingAnswers);

    } catch (err) {
        console.error("Failed to load practice reviews", err);
    }
}
async function reviewAnswer(practiceId, action) {
    console.log("Clicked:", practiceId, action);

    try {
        const res = await fetch(
            "https://doubtout-website.onrender.com/api/professor/practice/review",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    practice_id: practiceId,
                    professor_id: professor.user_id,
                    action: action
                })
            }
        );

        console.log("Response status:", res.status);

        const data = await res.json();
        console.log("Response data:", data);

        if (!res.ok) {
            alert(data.error || "Review failed");
            return;
        }

        alert(`Answer ${action} successfully`);
        loadPendingReviews();

    } catch (err) {
        console.error("Fetch error:", err);
        alert("Network/server error");
    }
}

</script>
</body>
</html>
